<div class="lesson-page">
  @if (isLoading()) {
    <div class="lesson-page__loading">
      <div class="loading-spinner"></div>
      <p>טוען שיעור...</p>
    </div>
  } @else if (lesson()) {
    <!-- Top Bar -->
    <div class="lesson-page__topbar">
      <button class="topbar__back" (click)="onBackToCourse()">
        <span class="material-icons-outlined">arrow_forward</span>
        חזרה לקורס
      </button>

      <div class="topbar__position">
        שיעור {{ position().current }} מתוך {{ position().total }}
      </div>

      <div class="topbar__status">
        @if (isCompleted()) {
          <span class="status-badge status-badge--completed">
            <span class="material-icons">check</span>
            הושלם
          </span>
        }
      </div>
    </div>

    <!-- Main Content -->
    <div class="lesson-page__content">
      <h1 class="lesson-page__title">{{ lesson()!.title }}</h1>

      @if (lesson()!.description) {
        <p class="lesson-page__description">{{ lesson()!.description }}</p>
      }

      <!-- Video Content -->
      @if (lesson()!.type === 'video' && videoEmbedUrl()) {
        <div class="lesson-page__video">
          @if (isYouTube()) {
            <iframe
              [src]="videoEmbedUrl()"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
            ></iframe>
          } @else {
            <video controls [src]="lesson()!.videoUrl">
              הדפדפן שלך לא תומך בנגן וידאו
            </video>
          }
        </div>
      }

      <!-- Text Content -->
      @if (lesson()!.type === 'text' && lesson()!.content) {
        <div class="lesson-page__text">
          {{ lesson()!.content }}
        </div>
      }

      <!-- Quiz / Practice Section -->
      @if (lesson()!.type === 'quiz') {
        <div class="lesson-page__practice-section">
          <div class="practice-card">
            <div class="practice-card__icon">
              <span class="material-icons">quiz</span>
            </div>
            <div class="practice-card__content">
              <h3>בדוק את הידע שלך</h3>
              <p>תרגל את החומר שלמדת עם שאלות אמריקאיות ובדוק את ההבנה שלך לפני המבחן.</p>
              <div class="practice-card__features">
                <span class="feature-item">
                  <span class="material-icons-outlined">shuffle</span>
                  שאלות אקראיות
                </span>
                <span class="feature-item">
                  <span class="material-icons-outlined">lightbulb</span>
                  הסברים מפורטים
                </span>
                <span class="feature-item">
                  <span class="material-icons-outlined">trending_up</span>
                  מעקב התקדמות
                </span>
              </div>
            </div>
            <div class="practice-card__action">
              <app-button variant="primary" size="lg" (buttonClick)="onStartPractice()">
                <span class="material-icons" style="font-size: 20px; margin-left: 8px;">play_arrow</span>
                התחל תרגול
              </app-button>
            </div>
          </div>
        </div>
      }

      <!-- No Content -->
      @if (!lesson()!.videoUrl && !lesson()!.content && lesson()!.type !== 'quiz') {
        <div class="lesson-page__no-content">
          <span class="material-icons-outlined placeholder-icon">description</span>
          <h3>תוכן בהכנה</h3>
          <p>התוכן לשיעור זה יהיה זמין בקרוב</p>
        </div>
      }
    </div>

    <!-- Bottom Actions -->
    <div class="lesson-page__actions">
      <div class="actions__nav">
        <button
          class="nav-button nav-button--prev"
          [disabled]="!prevLesson()"
          (click)="onPrevious()"
        >
          <span class="material-icons-outlined">arrow_forward</span>
          הקודם
        </button>

        <button
          class="nav-button nav-button--next"
          [disabled]="!nextLesson()"
          (click)="onNext()"
        >
          הבא
          <span class="material-icons-outlined">arrow_back</span>
        </button>
      </div>

      <div class="actions__complete">
        @if (!isCompleted()) {
          <app-button
            variant="primary"
            [disabled]="isMarkingComplete()"
            (buttonClick)="onMarkComplete()"
          >
            @if (isMarkingComplete()) {
              מסמן...
            } @else {
              סיימתי שיעור זה
            }
          </app-button>
        } @else {
          <div class="complete-message">
            <span class="material-icons">check_circle</span>
            <span>שיעור זה הושלם!</span>
          </div>
        }
      </div>
    </div>
  } @else {
    <!-- Lesson not found -->
    <div class="lesson-page__not-found">
      <span class="material-icons-outlined not-found-icon">error_outline</span>
      <h2>השיעור לא נמצא</h2>
      <p>לא הצלחנו למצוא את השיעור המבוקש</p>
      <app-button variant="secondary" (buttonClick)="onBackToCourse()">
        חזרה לקורס
      </app-button>
    </div>
  }
</div>
