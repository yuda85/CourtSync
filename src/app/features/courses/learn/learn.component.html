<div class="learn">
  @if (isLoading()) {
    <div class="learn__loading">
      <div class="loading-spinner"></div>
      <p>טוען...</p>
    </div>
  } @else {
    <div class="learn__content">
      <!-- Back Button -->
      <button class="learn__back" (click)="onBack()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9,18 15,12 9,6" />
        </svg>
        חזרה לפרטי הקורס
      </button>

      @if (course()) {
        <!-- Course Header -->
        <div class="learn__header">
          <div class="learn__header-content">
            <h1 class="learn__title">{{ course()!.title }}</h1>

            <div class="learn__meta">
              <span class="learn__meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                </svg>
                {{ lessons().length }} שיעורים
              </span>

              @if (totalDuration() > 0) {
                <span class="learn__meta-item">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                  </svg>
                  {{ formatDuration(totalDuration()) }}
                </span>
              }

              <span class="learn__meta-item learn__meta-item--progress">
                <app-progress-pill [percent]="progressPercent()" size="md" />
              </span>
            </div>
          </div>

          <div class="learn__header-actions">
            @if (lessons().length > 0) {
              <app-button variant="primary" (buttonClick)="onContinue()">
                @if (progressPercent() === 0) {
                  התחל ללמוד
                } @else if (progressPercent() === 100) {
                  צפה שוב
                } @else {
                  המשך ללמוד
                }
              </app-button>
              <app-button variant="secondary" (buttonClick)="onPractice()">
                <span class="material-icons btn-icon">quiz</span>
                תרגול
              </app-button>
            }
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="learn__stats">
          <div class="stat-card">
            <div class="stat-card__value">{{ completedCount() }}</div>
            <div class="stat-card__label">שיעורים הושלמו</div>
          </div>
          <div class="stat-card">
            <div class="stat-card__value">{{ lessons().length - completedCount() }}</div>
            <div class="stat-card__label">שיעורים נותרו</div>
          </div>
          <div class="stat-card stat-card--highlight">
            <div class="stat-card__value">{{ progressPercent() }}%</div>
            <div class="stat-card__label">התקדמות</div>
          </div>
        </div>

        <!-- Lessons Section -->
        <div class="learn__lessons">
          <h2 class="learn__section-title">שיעורי הקורס</h2>

          <app-lesson-list
            [lessons]="lessons()"
            [completedLessons]="completedLessons()"
            [currentLessonId]="currentLessonId()"
            (lessonClick)="onLessonClick($event)"
          />
        </div>
      } @else {
        <!-- Course not found -->
        <div class="learn__not-found">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
          <h2>הקורס לא נמצא</h2>
          <p>לא הצלחנו למצוא את הקורס המבוקש</p>
          <app-button variant="secondary" (buttonClick)="onBack()">
            חזרה לקטלוג
          </app-button>
        </div>
      }
    </div>
  }
</div>
